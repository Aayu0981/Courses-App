/*! For license information please see npm.m3u8-parser-f682487f63c0cfa9c987-1.5.es5.js.LICENSE.txt */
"use strict";(self["webpackChunkFutureLearn"]=self["webpackChunkFutureLearn"]||[]).push([["npm.m3u8-parser"],{"10ky":(t,e,i)=>{i.d(e,{_b:()=>b});var r=i("+5J7");var a=i("sglv");var n=i("+9dH");var s=i("Lr5L");var u=i("/9/d");var f=function(t){(0,r.Z)(e,t);function e(){var e;e=t.call(this)||this;e.buffer="";return e}var i=e.prototype;i.push=function(t){var e;this.buffer+=t;e=this.buffer.indexOf("\n");for(;e>-1;e=this.buffer.indexOf("\n")){this.trigger("data",this.buffer.substring(0,e));this.buffer=this.buffer.substring(e+1)}};return e}(a.Z);var o=String.fromCharCode(9);var g=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||"");var i={};if(e[1])i.length=parseInt(e[1],10);if(e[2])i.offset=parseInt(e[2],10);return i};var p=function(){var t="[^=]*";var e='"[^"]*"|[^,]*';var i="(?:"+t+")=(?:"+e+")";return new RegExp("(?:^|,)("+i+")")};var c=function(t){var e=t.split(p());var i={};var r=e.length;var a;while(r--){if(""===e[r])continue;a=/([^=]*)=(.*)/.exec(e[r]).slice(1);a[0]=a[0].replace(/^\s+|\s+$/g,"");a[1]=a[1].replace(/^\s+|\s+$/g,"");a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1");i[a[0]]=a[1]}return i};var d=function(t){(0,r.Z)(e,t);function e(){var e;e=t.call(this)||this;e.customParsers=[];e.tagMappers=[];return e}var i=e.prototype;i.push=function(t){var e=this;var i;var r;t=t.trim();if(0===t.length)return;if("#"!==t[0]){this.trigger("data",{type:"uri",uri:t});return}var a=this.tagMappers.reduce((function(e,i){var r=i(t);if(r===t)return e;return e.concat([r])}),[t]);a.forEach((function(t){for(var a=0;a<e.customParsers.length;a++)if(e.customParsers[a].call(e,t))return;if(0!==t.indexOf("#EXT")){e.trigger("data",{type:"comment",text:t.slice(1)});return}t=t.replace("\r","");i=/^#EXTM3U/.exec(t);if(i){e.trigger("data",{type:"tag",tagType:"m3u"});return}i=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"inf"};if(i[1])r.duration=parseFloat(i[1]);if(i[2])r.title=i[2];e.trigger("data",r);return}i=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"targetduration"};if(i[1])r.duration=parseInt(i[1],10);e.trigger("data",r);return}i=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"version"};if(i[1])r.version=parseInt(i[1],10);e.trigger("data",r);return}i=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"media-sequence"};if(i[1])r.number=parseInt(i[1],10);e.trigger("data",r);return}i=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"discontinuity-sequence"};if(i[1])r.number=parseInt(i[1],10);e.trigger("data",r);return}i=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"playlist-type"};if(i[1])r.playlistType=i[1];e.trigger("data",r);return}i=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t);if(i){r=(0,n.Z)(g(i[1]),{type:"tag",tagType:"byterange"});e.trigger("data",r);return}i=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t);if(i){r={type:"tag",tagType:"allow-cache"};if(i[1])r.allowed=!/NO/.test(i[1]);e.trigger("data",r);return}i=/^#EXT-X-MAP:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"map"};if(i[1]){var s=c(i[1]);if(s.URI)r.uri=s.URI;if(s.BYTERANGE)r.byterange=g(s.BYTERANGE)}e.trigger("data",r);return}i=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"stream-inf"};if(i[1]){r.attributes=c(i[1]);if(r.attributes.RESOLUTION){var u=r.attributes.RESOLUTION.split("x");var f={};if(u[0])f.width=parseInt(u[0],10);if(u[1])f.height=parseInt(u[1],10);r.attributes.RESOLUTION=f}if(r.attributes.BANDWIDTH)r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10);if(r.attributes["PROGRAM-ID"])r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10)}e.trigger("data",r);return}i=/^#EXT-X-MEDIA:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"media"};if(i[1])r.attributes=c(i[1]);e.trigger("data",r);return}i=/^#EXT-X-ENDLIST/.exec(t);if(i){e.trigger("data",{type:"tag",tagType:"endlist"});return}i=/^#EXT-X-DISCONTINUITY/.exec(t);if(i){e.trigger("data",{type:"tag",tagType:"discontinuity"});return}i=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"program-date-time"};if(i[1]){r.dateTimeString=i[1];r.dateTimeObject=new Date(i[1])}e.trigger("data",r);return}i=/^#EXT-X-KEY:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"key"};if(i[1]){r.attributes=c(i[1]);if(r.attributes.IV){if("0x"===r.attributes.IV.substring(0,2).toLowerCase())r.attributes.IV=r.attributes.IV.substring(2);r.attributes.IV=r.attributes.IV.match(/.{8}/g);r.attributes.IV[0]=parseInt(r.attributes.IV[0],16);r.attributes.IV[1]=parseInt(r.attributes.IV[1],16);r.attributes.IV[2]=parseInt(r.attributes.IV[2],16);r.attributes.IV[3]=parseInt(r.attributes.IV[3],16);r.attributes.IV=new Uint32Array(r.attributes.IV)}}e.trigger("data",r);return}i=/^#EXT-X-START:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"start"};if(i[1]){r.attributes=c(i[1]);r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]);r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)}e.trigger("data",r);return}i=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"cue-out-cont"};if(i[1])r.data=i[1];else r.data="";e.trigger("data",r);return}i=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"cue-out"};if(i[1])r.data=i[1];else r.data="";e.trigger("data",r);return}i=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"cue-in"};if(i[1])r.data=i[1];else r.data="";e.trigger("data",r);return}i=/^#EXT-X-SKIP:(.*)$/.exec(t);if(i&&i[1]){r={type:"tag",tagType:"skip"};r.attributes=c(i[1]);if(r.attributes.hasOwnProperty("SKIPPED-SEGMENTS"))r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10);if(r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES"))r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split(o);e.trigger("data",r);return}i=/^#EXT-X-PART:(.*)$/.exec(t);if(i&&i[1]){r={type:"tag",tagType:"part"};r.attributes=c(i[1]);["DURATION"].forEach((function(t){if(r.attributes.hasOwnProperty(t))r.attributes[t]=parseFloat(r.attributes[t])}));["INDEPENDENT","GAP"].forEach((function(t){if(r.attributes.hasOwnProperty(t))r.attributes[t]=/YES/.test(r.attributes[t])}));if(r.attributes.hasOwnProperty("BYTERANGE"))r.attributes.byterange=g(r.attributes.BYTERANGE);e.trigger("data",r);return}i=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t);if(i&&i[1]){r={type:"tag",tagType:"server-control"};r.attributes=c(i[1]);["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){if(r.attributes.hasOwnProperty(t))r.attributes[t]=parseFloat(r.attributes[t])}));["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){if(r.attributes.hasOwnProperty(t))r.attributes[t]=/YES/.test(r.attributes[t])}));e.trigger("data",r);return}i=/^#EXT-X-PART-INF:(.*)$/.exec(t);if(i&&i[1]){r={type:"tag",tagType:"part-inf"};r.attributes=c(i[1]);["PART-TARGET"].forEach((function(t){if(r.attributes.hasOwnProperty(t))r.attributes[t]=parseFloat(r.attributes[t])}));e.trigger("data",r);return}i=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t);if(i&&i[1]){r={type:"tag",tagType:"preload-hint"};r.attributes=c(i[1]);["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(r.attributes.hasOwnProperty(t)){r.attributes[t]=parseInt(r.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";r.attributes.byterange=r.attributes.byterange||{};r.attributes.byterange[e]=r.attributes[t];delete r.attributes[t]}}));e.trigger("data",r);return}i=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t);if(i&&i[1]){r={type:"tag",tagType:"rendition-report"};r.attributes=c(i[1]);["LAST-MSN","LAST-PART"].forEach((function(t){if(r.attributes.hasOwnProperty(t))r.attributes[t]=parseInt(r.attributes[t],10)}));e.trigger("data",r);return}e.trigger("data",{type:"tag",data:t.slice(4)})}))};i.addParser=function(t){var e=this;var i=t.expression,r=t.customType,a=t.dataParser,n=t.segment;if("function"!==typeof a)a=function(t){return t};this.customParsers.push((function(t){var s=i.exec(t);if(s){e.trigger("data",{type:"custom",data:a(t),customType:r,segment:n});return true}}))};i.addTagMapper=function(t){var e=t.expression,i=t.map;var r=function(t){if(e.test(t))return i(t);return t};this.tagMappers.push(r)};return e}(a.Z);var E=function(t){return t.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()}))};var T=function(t){var e={};Object.keys(t).forEach((function(i){e[E(i)]=t[i]}));return e};var h=function(t){var e=t.serverControl,i=t.targetDuration,r=t.partTargetDuration;if(!e)return;var a="#EXT-X-SERVER-CONTROL";var n="holdBack";var s="partHoldBack";var u=i&&3*i;var f=r&&2*r;if(i&&!e.hasOwnProperty(n)){e[n]=u;this.trigger("info",{message:a+" defaulting HOLD-BACK to targetDuration * 3 ("+u+")."})}if(u&&e[n]<u){this.trigger("warn",{message:a+" clamping HOLD-BACK ("+e[n]+") to targetDuration * 3 ("+u+")"});e[n]=u}if(r&&!e.hasOwnProperty(s)){e[s]=3*r;this.trigger("info",{message:a+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[s]+")."})}if(r&&e[s]<f){this.trigger("warn",{message:a+" clamping PART-HOLD-BACK ("+e[s]+") to partTargetDuration * 2 ("+f+")."});e[s]=f}};var b=function(t){(0,r.Z)(e,t);function e(){var e;e=t.call(this)||this;e.lineStream=new f;e.parseStream=new d;e.lineStream.pipe(e.parseStream);var i=(0,s.Z)(e);var r=[];var a={};var o;var g;var p=false;var c=function(){};var E={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};var b="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";var m=0;e.manifest={allowCache:true,discontinuityStarts:[],segments:[]};var l=0;var y=0;e.on("end",(function(){if(a.uri||!a.parts&&!a.preloadHints)return;if(!a.map&&o)a.map=o;if(!a.key&&g)a.key=g;if(!a.timeline&&"number"===typeof m)a.timeline=m;e.manifest.preloadSegment=a}));e.parseStream.on("data",(function(t){var e;var s;({tag:function(){({version:function(){if(t.version)this.manifest.version=t.version},"allow-cache":function(){this.manifest.allowCache=t.allowed;if(!("allowed"in t)){this.trigger("info",{message:"defaulting allowCache to YES"});this.manifest.allowCache=true}},byterange:function(){var e={};if("length"in t){a.byterange=e;e.length=t.length;if(!("offset"in t))t.offset=l}if("offset"in t){a.byterange=e;e.offset=t.offset}l=e.offset+e.length},endlist:function(){this.manifest.endList=true},inf:function(){if(!("mediaSequence"in this.manifest)){this.manifest.mediaSequence=0;this.trigger("info",{message:"defaulting media sequence to zero"})}if(!("discontinuitySequence"in this.manifest)){this.manifest.discontinuitySequence=0;this.trigger("info",{message:"defaulting discontinuity sequence to zero"})}if(t.duration>0)a.duration=t.duration;if(0===t.duration){a.duration=.01;this.trigger("info",{message:"updating zero segment duration to a small value"})}this.manifest.segments=r},key:function(){if(!t.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if("NONE"===t.attributes.METHOD){g=null;return}if(!t.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if("com.apple.streamingkeydelivery"===t.attributes.KEYFORMAT){this.manifest.contentProtection=this.manifest.contentProtection||{};this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:t.attributes};return}if("com.microsoft.playready"===t.attributes.KEYFORMAT){this.manifest.contentProtection=this.manifest.contentProtection||{};this.manifest.contentProtection["com.microsoft.playready"]={uri:t.attributes.URI};return}if(t.attributes.KEYFORMAT===b){var e=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];if(-1===e.indexOf(t.attributes.METHOD)){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if("SAMPLE-AES-CENC"===t.attributes.METHOD)this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"});if("data:text/plain;base64,"!==t.attributes.URI.substring(0,23)){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2))){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{};this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:(0,u.Z)(t.attributes.URI.split(",")[1])};return}if(!t.attributes.METHOD)this.trigger("warn",{message:"defaulting key method to AES-128"});g={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI};if("undefined"!==typeof t.attributes.IV)g.iv=t.attributes.IV},"media-sequence":function(){if(!isFinite(t.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number});return}this.manifest.mediaSequence=t.number},"discontinuity-sequence":function(){if(!isFinite(t.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number});return}this.manifest.discontinuitySequence=t.number;m=t.number},"playlist-type":function(){if(!/VOD|EVENT/.test(t.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist});return}this.manifest.playlistType=t.playlistType},map:function(){o={};if(t.uri)o.uri=t.uri;if(t.byterange)o.byterange=t.byterange;if(g)o.key=g},"stream-inf":function(){this.manifest.playlists=r;this.manifest.mediaGroups=this.manifest.mediaGroups||E;if(!t.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}if(!a.attributes)a.attributes={};(0,n.Z)(a.attributes,t.attributes)},media:function(){this.manifest.mediaGroups=this.manifest.mediaGroups||E;if(!(t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var i=this.manifest.mediaGroups[t.attributes.TYPE];i[t.attributes["GROUP-ID"]]=i[t.attributes["GROUP-ID"]]||{};e=i[t.attributes["GROUP-ID"]];s={default:/yes/i.test(t.attributes.DEFAULT)};if(s.default)s.autoselect=true;else s.autoselect=/yes/i.test(t.attributes.AUTOSELECT);if(t.attributes.LANGUAGE)s.language=t.attributes.LANGUAGE;if(t.attributes.URI)s.uri=t.attributes.URI;if(t.attributes["INSTREAM-ID"])s.instreamId=t.attributes["INSTREAM-ID"];if(t.attributes.CHARACTERISTICS)s.characteristics=t.attributes.CHARACTERISTICS;if(t.attributes.FORCED)s.forced=/yes/i.test(t.attributes.FORCED);e[t.attributes.NAME]=s},discontinuity:function(){m+=1;a.discontinuity=true;this.manifest.discontinuityStarts.push(r.length)},"program-date-time":function(){if("undefined"===typeof this.manifest.dateTimeString){this.manifest.dateTimeString=t.dateTimeString;this.manifest.dateTimeObject=t.dateTimeObject}a.dateTimeString=t.dateTimeString;a.dateTimeObject=t.dateTimeObject},targetduration:function(){if(!isFinite(t.duration)||t.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration});return}this.manifest.targetDuration=t.duration;h.call(this,this.manifest)},start:function(){if(!t.attributes||isNaN(t.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}},"cue-out":function(){a.cueOut=t.data},"cue-out-cont":function(){a.cueOutCont=t.data},"cue-in":function(){a.cueIn=t.data},skip:function(){this.manifest.skip=T(t.attributes);this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;p=true;var i=this.manifest.segments.length;var r=T(t.attributes);a.parts=a.parts||[];a.parts.push(r);if(r.byterange){if(!r.byterange.hasOwnProperty("offset"))r.byterange.offset=y;y=r.byterange.offset+r.byterange.length}var n=a.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+n+" for segment #"+i,t.attributes,["URI","DURATION"]);if(this.manifest.renditionReports)this.manifest.renditionReports.forEach((function(t,i){if(!t.hasOwnProperty("lastPart"))e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+i+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=T(t.attributes);if(!e.hasOwnProperty("canBlockReload")){e.canBlockReload=false;this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})}h.call(this,this.manifest);if(e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil"))this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length;var i=T(t.attributes);var r=i.type&&"PART"===i.type;a.preloadHints=a.preloadHints||[];a.preloadHints.push(i);if(i.byterange)if(!i.byterange.hasOwnProperty("offset")){i.byterange.offset=r?y:0;if(r)y=i.byterange.offset+i.byterange.length}var n=a.preloadHints.length-1;this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+n+" for segment #"+e,t.attributes,["TYPE","URI"]);if(!i.type)return;for(var s=0;s<a.preloadHints.length-1;s++){var u=a.preloadHints[s];if(!u.type)continue;if(u.type===i.type)this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+n+" for segment #"+e+" has the same TYPE "+i.type+" as preload hint #"+s})}},"rendition-report":function(){var e=T(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[];this.manifest.renditionReports.push(e);var i=this.manifest.renditionReports.length-1;var r=["LAST-MSN","URI"];if(p)r.push("LAST-PART");this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+i,t.attributes,r)},"part-inf":function(){this.manifest.partInf=T(t.attributes);this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]);if(this.manifest.partInf.partTarget)this.manifest.partTargetDuration=this.manifest.partInf.partTarget;h.call(this,this.manifest)}}[t.tagType]||c).call(i)},uri:function(){a.uri=t.uri;r.push(a);if(this.manifest.targetDuration&&!("duration"in a)){this.trigger("warn",{message:"defaulting segment duration to the target duration"});a.duration=this.manifest.targetDuration}if(g)a.key=g;a.timeline=m;if(o)a.map=o;y=0;a={}},comment:function(){},custom:function(){if(t.segment){a.custom=a.custom||{};a.custom[t.customType]=t.data}else{this.manifest.custom=this.manifest.custom||{};this.manifest.custom[t.customType]=t.data}}})[t.type].call(i)}));return e}var i=e.prototype;i.warnOnMissingAttributes_=function(t,e,i){var r=[];i.forEach((function(t){if(!e.hasOwnProperty(t))r.push(t)}));if(r.length)this.trigger("warn",{message:t+" lacks required attribute(s): "+r.join(", ")})};i.push=function(t){this.lineStream.push(t)};i.end=function(){this.lineStream.push("\n");this.trigger("end")};i.addParser=function(t){this.parseStream.addParser(t)};i.addTagMapper=function(t){this.parseStream.addTagMapper(t)};return e}(a.Z)}}]);